# 代码生成
## 介绍
`minigo` 后端使用 Rust 编程语言实现了将 LLVM IR 翻译成 RISC-V 64 的汇编，并借助 `riscv64-unknown-elf-gcc` 可以将生成的汇编编译成 riscv 64 的 elf 文件，进而可以运行在 `qemu-roscv64` 的用户模式上
## 实现
### IR 解析
本项目借助了 Rust 的 `llvm_ir` crate 可以将裸的 LLVM IR 转换成 Rust 的数据结构描述，转换成的数据结构有如下几个基础的数据结构：
- `BasicBlock`: 用于存储一连串指令的数据结构，通常在跳转指令或者返回指令分隔
- `Function`: 用于存储一连串 `BasicBlock`, 同时存储参数，返回类型等其他信息
- `Instruction`: 用于描述指令
- `Operand`：用于描述操作数，既可以存储局部变量（虚拟寄存器），也可以存储常量
- `Module`：用于描述整个 llvm ir 文件，包含数据布局，函数几何，全局变量，内联汇编等内容
- `Terminator`: 用于描述各个块之间终结符指令  

由于生成的数据结构过于复杂，因此我们在原有的数据结构上重新设计了一套更为精简的数据结构，LLVM IR 翻译的过程即是将对应的数据结构转化成我们的数据结构
### 代码生成  
代码生成是编译器后端的核心部分，在翻译每个函数的指令之前首先需要作预处理的工作。首先需要将 `ra` 和 `fp` 寄存器存储在栈顶，然后将 `fp` 移到 `sp` 相同位置，随后可以开始执行指令。
### 数据生成
### 寄存器分配
### 测试
## 结果